#ifndef DisplayManager_h
#define DisplayManager_h
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET    -1

// Definiere die GPIO-Pins für das I2C-Display
#define OLED_SDA 21 // GPIO21
#define OLED_SCL 22 // GPIO22

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

const unsigned char hoverLogo [] PROGMEM = {	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xc7, 0xde, 0x3f, 0xf9, 0xdf, 0x0f, 0xff, 0xe0, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xc9, 0xcc, 0x93, 0xb2, 0xdd, 0x9f, 0xff, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xdd, 0xac, 0xf3, 0xb7, 0xdd, 0x9f, 0xf8, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xdc, 0xa6, 0x33, 0xb7, 0xc1, 0x9f, 0xf0, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xdc, 0x87, 0x93, 0xb7, 0xd9, 0x9f, 0xc0, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xdd, 0x35, 0xd3, 0xb6, 0x5d, 0x9f, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xc3, 0x72, 0x30, 0xb8, 0xdd, 0x9f, 0x00, 0x1f, 0xfe, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x7f, 0xff, 0x80, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x01, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x07, 0xff, 0xff, 0xf0, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x0f, 0xff, 0xff, 0xfc, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0x00, 0x03, 0xfe, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xfc, 0x00, 0x07, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xf8, 0x00, 0x1f, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xfc, 0x00, 0x3f, 0xbf, 0x80, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xfc, 0x00, 0x7c, 0x07, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xfe, 0x00, 0xf8, 0x03, 0xff, 0xfc, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0x00, 0xf0, 0x01, 0xe0, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0x80, 0xf0, 0xe1, 0xe0, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xc0, 0xf1, 0xf0, 0xe0, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xf0, 0xe1, 0xf0, 0xe0, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xf8, 0xf1, 0xf0, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xfe, 0xf0, 0xe1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x03, 0xff, 0xe0, 0x1f, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x07, 0xc1, 0xc0, 0x07, 0xc1, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x9f, 0x81, 0xc0, 0x01, 0xc1, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xdf, 0xff, 0x01, 0xc0, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xe7, 0xfe, 0x01, 0xc0, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xe1, 0xe0, 0x01, 0xc0, 0x08, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x01, 0xc0, 0x3c, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x01, 0x81, 0xc0, 0xf8, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x03, 0xe1, 0xc1, 0xf0, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x01, 0xf1, 0xc3, 0xc0, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x71, 0xc7, 0x80, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x01, 0xc0, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x01, 0xc0, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x01, 0xc0, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xfc, 0x0e, 0x07, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xc1, 0xe0, 0x7f, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xc0, 0x27, 0xec, 0xff, 0xfd, 0xf3, 0xf1, 0xe7, 0xec, 0x03, 0x03, 0xff, 0xcf, 0xff, 0xff, 0xff, 
0xc0, 0x23, 0xcc, 0xff, 0xf8, 0xf3, 0xc0, 0x63, 0xec, 0x03, 0x00, 0x7f, 0x03, 0xf0, 0xf8, 0x03, 
0xfe, 0x33, 0x9c, 0xff, 0xf8, 0xf3, 0x8e, 0x33, 0xcc, 0xff, 0x3c, 0x7e, 0x31, 0xf0, 0xf8, 0xe3, 
0xfe, 0x71, 0x9c, 0xff, 0xf8, 0xf3, 0x9f, 0x33, 0xcc, 0xff, 0x3e, 0x7e, 0x78, 0xf0, 0xf9, 0xf1, 
0xfc, 0xf9, 0x3c, 0xff, 0xf8, 0xf3, 0x9f, 0x31, 0xcc, 0xff, 0x3e, 0x7e, 0x7c, 0xe4, 0x79, 0xf1, 
0xf8, 0xf8, 0x3c, 0xff, 0xf8, 0x03, 0x1f, 0x19, 0x9c, 0x0f, 0x3c, 0x7c, 0x7f, 0xe6, 0x79, 0xf1, 
0xf1, 0xfc, 0x7c, 0xff, 0xf8, 0x03, 0x1f, 0x19, 0x9c, 0x07, 0x00, 0xfc, 0x7f, 0xee, 0x78, 0x03, 
0xf3, 0xfc, 0x7c, 0xf8, 0x78, 0xf3, 0x1f, 0x18, 0x9c, 0x7f, 0x19, 0xfc, 0x7f, 0xce, 0x38, 0x07, 
0xe7, 0xfc, 0x7c, 0xff, 0xf8, 0xf3, 0x9f, 0x3c, 0xbc, 0xff, 0x3c, 0xfc, 0x7f, 0xc0, 0x39, 0xe7, 
0xc7, 0xfc, 0x7c, 0xff, 0xf8, 0xf3, 0x9f, 0x3c, 0x3c, 0xff, 0x3c, 0xfe, 0x7c, 0xc0, 0x39, 0xe7, 
0xc0, 0x3c, 0x7c, 0x07, 0xf8, 0xf3, 0x8e, 0x3c, 0x3c, 0x7f, 0x3c, 0x7e, 0x38, 0x9f, 0x19, 0xe3, 
0xc0, 0x3c, 0x7c, 0x07, 0xf8, 0xf3, 0xc0, 0x7e, 0x7c, 0x03, 0x3e, 0x7f, 0x01, 0x9f, 0x99, 0xf3, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf1, 0xff, 0xff, 0xff, 0xff, 0xff, 0x83, 0xbf, 0x99, 0xf3, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
};

class DisplayManager {
  public:
    void setup() {

      Wire.begin(OLED_SDA, OLED_SCL); // Initialisiere I2C mit SDA und SCL Pins
      if (!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
        Serial.println(F("SSD1306 allocation failed"));
        for (;;);
      }
      delay(2000);
      display.clearDisplay();

            // Dein Bitmap anzeigen
      display.drawBitmap( 0, 0, hoverLogo, SCREEN_WIDTH, SCREEN_HEIGHT, WHITE);

      display.display();
    }

    void displayLogo(){
      display.clearDisplay();
    }


    void displayMessage(const String& message) {
      display.clearDisplay(); // Lösche den aktuellen Inhalt des Displays
      display.setTextSize(2); // Setze die Textgröße. 
      display.setTextColor(SSD1306_WHITE); // Setze die Textfarbe
      display.setCursor(0, 0); // Setze den Cursor an den Anfang des Displays
      display.println(message); 
      display.display(); // Zeige die Änderungen auf dem Display an
    }

    void displaySpeedmode(String mode){
      display.drawRoundRect (0, 0, 22, 30,5, SSD1306_WHITE);
      display.setTextColor(SSD1306_WHITE); // Setze die Textfarbe
      display.setCursor(3, 5); // Setze den Cursor an den Anfang des Displays
      display.setTextSize(3); // Setze die Textgröße. 
      display.println(mode); 
    }

    void displayNm(float Nm){
      display.setTextColor(SSD1306_WHITE); // Setze die Textfarbe
      display.setCursor(24, 0); // Setze den Cursor an den Anfang des Displays
      display.setTextSize(1); // Setze die Textgröße. 
      display.println(String(Nm) + "Nm"); 
    }

    void displaySpeed(float requestKmh, float currentKmh, int maxKMH){
      if (requestKmh < 0){
        requestKmh = requestKmh * -1;
      }
      if (currentKmh < 0){
        currentKmh = currentKmh * -1;
      }

      //set kmh Text
      display.setCursor(24, 18); // Setze den Cursor hinter 'mode'
      //set kmh Value
      display.setTextSize(7); 
      int kmhInt = currentKmh + 0.5;
      String displayKmhValue;
      if (kmhInt < 10){
        displayKmhValue = "0" + String(kmhInt);
        }
      else {
        displayKmhValue = String(kmhInt);
        }
      display.print(displayKmhValue); 
    }

    void displayBat(int batPercent, float vBat){
      display.fillRect(115, 0, 6, 2, SSD1306_WHITE);
      display.drawRoundRect (108, 2, 20, 30,3, SSD1306_WHITE);

      if (batPercent > 80){
        display.fillRect(110, 6, 16, 5, SSD1306_WHITE);
      }
      if (batPercent > 60){
        display.fillRect(110, 12, 16, 5, SSD1306_WHITE);
      }
      if (batPercent > 40){
        display.fillRect(110, 18, 16, 5, SSD1306_WHITE);
      }
      if (batPercent > 20){
        display.fillRect(110, 24, 16, 5, SSD1306_WHITE);
      }
      display.setCursor(108, 34); // Setze den Cursor hinter 'mode'
      display.setTextSize(1); 
      display.setTextColor(SSD1306_WHITE); // Setze die Textfarbe
      display.println(String(int(vBat + 0.5)) + "V");
    }

    void vBatLowError(float vBat){
      bool show = false;
      while(true){
        display.clearDisplay(); // Lösche Displayinhalt
        display.setCursor(0, 0); // Setze den Cursor hinter 'mode'
        display.setTextSize(2); 
        display.setTextColor(SSD1306_WHITE); // Setze die Textfarbe
        display.println("Batterie");
        display.print("leer");
        if (show == false){
          displayBat(21, vBat);
          show = true;
          }
        else{
          show=false;
          }
        display.display();
        delay(1000);
      }
    }

    void displayDashboard(float requestKmh, float currentKmh, int batPercent, float vBat, String mode, int maxKMH, float Nm){
      display.clearDisplay(); // Lösche Displayinhalt
      // bauer Displayinhalt neu auf
      displaySpeedmode(mode); // Setze Geschwindigkeitsmodus (R/1/2/3/4)
      displaySpeed(requestKmh, currentKmh, maxKMH); // Setze Kmh 
      displayBat(batPercent, vBat);
      displayNm(Nm);
      display.display(); // Zeige die Änderungen auf dem Display an
    }


    void displayMessage(float number) {
      String message = String(number); // Konvertiere float zu String
      displayMessage(message); // Rufe die ursprüngliche Funktion au
    }

  private:
};

#endif